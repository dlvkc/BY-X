name: Run web
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:
  
env:
  WEBNM: ${{ secrets.WEBNM || 'hi' }}
  UUID: ${{ secrets.UUID || 'de04add9-5b68-8bab-950c-08cd5320df18' }}
  VMESS: ${{ secrets.VMESS || 'vmess' }}
  VLESS: ${{ secrets.VLESS || 'vless' }}
  TROJAN: ${{ secrets.TROJAN || 'trojan' }}
  SHADOWSOCKS: ${{ secrets.SHADOWSOCKS || 'shadowsocks' }}

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4  # âœ… ç¡®ä¿ checkout ä¹Ÿæ˜¯æœ€æ–°ç‰ˆæœ¬

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: 1.19.5

      - name: Run xray
        run: |
          go version
          wget https://github.com/XTLS/Xray-core/archive/refs/tags/v1.7.2.zip
          unzip v1.7.2.zip
          mv web.sh Xray-core-1.7.2
          cd Xray-core-1.7.2
          bash web.sh
          go build -o ${WEBNM} -trimpath -ldflags "-s -w -buildid=" ./main
          mv ${WEBNM} ../${WEBNM}  # ç§»åŠ¨ç¼–è¯‘å¥½çš„æ–‡ä»¶åˆ°ä»“åº“æ ¹ç›®å½•

      - name: Upload compiled binary
        uses: actions/upload-artifact@v4
        with:
          name: compiled-binary  # ğŸ‘ˆ è¿™é‡Œä¸èƒ½ä½¿ç”¨ `${WEBNM}`
          path: ${{ env.WEBNM }}  # âœ… è¿™é‡Œå¯ä»¥ç”¨ `${{ env.WEBNM }}` ä»£æ›¿
