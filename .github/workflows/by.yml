name: Run web

on:
  workflow_dispatch:
  
env:
  WEBNM: ${{ secrets.WEBNM || 'hi' }}
  UUID: ${{ secrets.UUID || 'de04add9-5b68-8bab-950c-08cd5320df18' }}
  VMESS: ${{ secrets.VMESS || 'vmess' }}
  VLESS: ${{ secrets.VLESS || 'vless' }}
  TROJAN: ${{ secrets.TROJAN || 'trojan' }}
  SHADOWSOCKS: ${{ secrets.SHADOWSOCKS || 'shadowsocks' }}

jobs:
  run_web:
    runs-on: ubuntu-20.04
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    - name: Set up Go 1.19.5
      uses: actions/setup-go@v1
      with:
        go-version: 1.19.5
    - name: Run xray
      run: |
        go version
        wget https://github.com/XTLS/Xray-core/archive/refs/tags/v1.7.2.zip
        unzip v1.7.2.zip
        mv web.sh Xray-core-1.7.2
        cd Xray-core-1.7.2
        bash web.sh
        go build -o ${WEBNM} -trimpath -ldflags "-s -w -buildid=" ./main
        mv ${WEBNM} ../${WEBNM}  # 移动编译好的文件到仓库根目录

      - name: Upload compiled binary
        uses: actions/upload-artifact@v4
        with:
          name: ${WEBNM}
          path: ${WEBNM}
